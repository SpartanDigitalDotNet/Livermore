---
name: perseus:discord
description: Post messages to Discord via the DISCORD_LIVERMORE_BOT webhook (Coinbase Alerts channel)
argument-hint: "[message or report name]"
allowed-tools:
  - Bash
  - Read
  - Glob
---

<objective>
Post messages or reports to the Discord Coinbase Alerts channel using the DISCORD_LIVERMORE_BOT
webhook. Handles Discord's 2000-character limit by automatically splitting long messages.
Can post raw text or generate and post known report types.
</objective>

<critical_rules>
- NEVER look for .env files. The webhook URL is in Windows User scope: DISCORD_LIVERMORE_BOT.
- Discord messages have a 2000 character limit. Split long messages into multiple posts.
- Always use the post-discord.ps1 wrapper script at `scripts/post-discord.ps1`.
- Use markdown formatting that Discord supports: **bold**, _italic_, `code`, ```code blocks```.
- When splitting messages, ensure each part is self-contained and readable.
- Always end reports with `_Generated by Perseus/Livermore_`.
</critical_rules>

<context>
## Posting Script

```
scripts/post-discord.ps1 -Message "your message here"
```

Invoked via:
```bash
powershell -NoProfile -ExecutionPolicy Bypass -File "scripts/post-discord.ps1" -Message "text"
```

## Known Report Types

| Report | Description | Data Source |
|--------|-------------|-------------|
| `oversold` | MACD-V oversold scanner across all timeframes | `scripts/check-macdv-oversold.ps1` |
| `macdv [SYMBOL]` | MACD-V for a specific symbol | `scripts/check-macdv.ps1 -Symbol "SYMBOL"` |
| `status` | Instance status summary | `scripts/test-v6-redis.ps1` |

## Discord Markdown

- **Bold:** `**text**`
- _Italic:_ `_text_`
- Code inline: `` \`text\` ``
- Code block: ``` \`\`\`text\`\`\` ```
- No tables â€” use code blocks with aligned columns instead.
- Max 2000 chars per message. Split at logical section breaks.
</context>

<process>
Parse $ARGUMENTS to determine what to post.

## Mode: raw message
If the argument is a plain text message, post it directly:

1. Check character count
2. If under 2000 chars, post as single message
3. If over 2000 chars, split at logical line breaks and post sequentially

## Mode: report name
If the argument matches a known report type (oversold, macdv, status):

1. Run the corresponding data source script to generate fresh data
2. Format the output for Discord (markdown, code blocks, aligned columns)
3. Split if needed and post to Discord
4. Confirm what was posted

## Posting

Always use:
```bash
powershell -NoProfile -ExecutionPolicy Bypass -File "scripts/post-discord.ps1" -Message "CONTENT"
```

## Splitting Strategy

When a message exceeds 2000 chars:
1. Find logical section breaks (timeframe headers, blank lines)
2. Split into chunks each under 1900 chars (buffer for formatting)
3. Post each chunk sequentially
4. First chunk gets the report header, last chunk gets the footer
</process>

<success_criteria>
- [ ] Message posted successfully to Discord
- [ ] Long messages split correctly at logical breaks
- [ ] Discord markdown renders properly
- [ ] Report data is fresh (generated at post time, not stale)
</success_criteria>
