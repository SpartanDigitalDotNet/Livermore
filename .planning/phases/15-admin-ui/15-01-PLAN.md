---
phase: 15-admin-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/admin/package.json
  - apps/admin/tsconfig.json
  - apps/admin/vite.config.ts
  - apps/admin/index.html
  - apps/admin/src/main.tsx
  - apps/admin/src/App.tsx
  - apps/admin/src/index.css
  - apps/admin/src/lib/trpc.ts
  - apps/admin/src/lib/utils.ts
  - apps/admin/src/vite-env.d.ts
  - apps/admin/.env.example
  - apps/admin/components.json
autonomous: true
user_setup:
  - service: clerk
    why: "Frontend authentication"
    env_vars:
      - name: VITE_CLERK_PUBLISHABLE_KEY
        source: "Clerk Dashboard -> API Keys -> Publishable key (same as backend)"

must_haves:
  truths:
    - "User can sign in with Google OAuth and see their identity in the UI"
    - "Unauthenticated access shows sign-in component"
    - "Authenticated user sees header with UserButton showing their avatar"
  artifacts:
    - path: "apps/admin/package.json"
      provides: "Admin app dependencies"
      contains: "@clerk/clerk-react"
    - path: "apps/admin/src/main.tsx"
      provides: "ClerkProvider and QueryClientProvider setup"
      exports: ["default"]
    - path: "apps/admin/src/App.tsx"
      provides: "SignedIn/SignedOut components with layout"
      exports: ["default"]
    - path: "apps/admin/src/lib/trpc.ts"
      provides: "tRPC client with Clerk auth headers"
      exports: ["trpc", "trpcClient"]
  key_links:
    - from: "apps/admin/src/main.tsx"
      to: "@clerk/clerk-react"
      via: "ClerkProvider wrapping app"
      pattern: "ClerkProvider"
    - from: "apps/admin/src/lib/trpc.ts"
      to: "apps/api/src/routers/index.ts"
      via: "import type { AppRouter }"
      pattern: "AppRouter"
---

<objective>
Create the admin UI foundation with Vite, React, Clerk authentication, and tRPC client.

Purpose: Establishes the authenticated SPA that connects to the existing Livermore API. Users can sign in with Google OAuth via Clerk and see their identity. This is the foundation for all UI requirements.

Output: Working admin app at `http://localhost:5173` with sign-in functionality and tRPC client ready for data fetching.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-admin-ui/15-RESEARCH.md

# Existing API structure
@apps/api/src/routers/index.ts
@apps/api/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite React app with dependencies</name>
  <files>
    apps/admin/package.json
    apps/admin/tsconfig.json
    apps/admin/vite.config.ts
    apps/admin/index.html
    apps/admin/src/vite-env.d.ts
    apps/admin/.env.example
  </files>
  <action>
Create the admin app directory and configure it:

1. Create `apps/admin/package.json`:
```json
{
  "name": "@livermore/admin",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "@clerk/clerk-react": "^5.20.1",
    "@tanstack/react-query": "^5.64.2",
    "@tanstack/react-table": "^8.21.2",
    "@trpc/client": "^11.0.2",
    "@trpc/tanstack-react-query": "^11.0.2",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "tailwindcss": "^4.0.0",
    "@tailwindcss/vite": "^4.0.0",
    "clsx": "^2.1.1",
    "tailwind-merge": "^3.0.1",
    "lucide-react": "^0.474.0"
  },
  "devDependencies": {
    "@types/node": "^22.10.5",
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "@vitejs/plugin-react": "^4.3.4",
    "typescript": "^5.6.3",
    "vite": "^6.0.7"
  }
}
```

2. Create `apps/admin/tsconfig.json` with path aliases:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}
```

3. Create `apps/admin/vite.config.ts`:
```typescript
import path from 'path';
import tailwindcss from '@tailwindcss/vite';
import react from '@vitejs/plugin-react';
import { defineConfig } from 'vite';

export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 5173,
  },
});
```

4. Create `apps/admin/index.html`:
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Livermore Admin</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

5. Create `apps/admin/src/vite-env.d.ts`:
```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_CLERK_PUBLISHABLE_KEY: string;
  readonly VITE_API_URL?: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

6. Create `apps/admin/.env.example`:
```
VITE_CLERK_PUBLISHABLE_KEY=pk_test_...
VITE_API_URL=http://localhost:3002/trpc
```

7. Run `pnpm install` in apps/admin to install dependencies.
  </action>
  <verify>
    Run `pnpm --filter @livermore/admin type-check` - should pass with no errors.
    Verify `apps/admin/node_modules` exists.
  </verify>
  <done>Admin app package created with all dependencies installed and TypeScript configured.</done>
</task>

<task type="auto">
  <name>Task 2: Create tRPC client and utility files</name>
  <files>
    apps/admin/src/lib/trpc.ts
    apps/admin/src/lib/utils.ts
  </files>
  <action>
1. Create `apps/admin/src/lib/trpc.ts` - tRPC client with Clerk auth headers:
```typescript
import { createTRPCClient, httpBatchLink } from '@trpc/client';
import { createTRPCOptionsProxy } from '@trpc/tanstack-react-query';
import type { AppRouter } from '../../../../apps/api/src/routers';

/**
 * Get Clerk token for authenticated API requests.
 * Clerk exposes session on window after ClerkProvider initializes.
 */
const getAuthToken = async (): Promise<string | null> => {
  if (typeof window !== 'undefined' && window.Clerk?.session) {
    return window.Clerk.session.getToken();
  }
  return null;
};

/**
 * tRPC vanilla client for direct API calls.
 */
export const trpcClient = createTRPCClient<AppRouter>({
  links: [
    httpBatchLink({
      url: import.meta.env.VITE_API_URL ?? 'http://localhost:3002/trpc',
      headers: async () => {
        const token = await getAuthToken();
        return token ? { Authorization: `Bearer ${token}` } : {};
      },
    }),
  ],
});

/**
 * tRPC options proxy for use with TanStack Query.
 * Usage: useQuery(trpc.indicator.getPortfolioAnalysis.queryOptions({ symbols }))
 */
export const trpc = createTRPCOptionsProxy<AppRouter>(trpcClient);
```

2. Create `apps/admin/src/lib/utils.ts` - utility for shadcn-style class merging:
```typescript
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

/**
 * Merge Tailwind classes with clsx.
 * Handles conditional classes and deduplication.
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

Note: The AppRouter import uses relative path since the admin app is in the same monorepo. The TypeScript bundler resolution will handle this correctly.
  </action>
  <verify>
    Run `pnpm --filter @livermore/admin type-check` - should pass (AppRouter type resolved correctly).
  </verify>
  <done>tRPC client configured with Clerk token injection and cn() utility available.</done>
</task>

<task type="auto">
  <name>Task 3: Create main.tsx, App.tsx, and index.css with Clerk auth</name>
  <files>
    apps/admin/src/main.tsx
    apps/admin/src/App.tsx
    apps/admin/src/index.css
  </files>
  <action>
1. Create `apps/admin/src/index.css` - TailwindCSS v4 with custom properties:
```css
@import "tailwindcss";

:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --card: 0 0% 100%;
  --card-foreground: 222.2 84% 4.9%;
  --primary: 222.2 47.4% 11.2%;
  --primary-foreground: 210 40% 98%;
  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222.2 47.4% 11.2%;
  --muted: 210 40% 96.1%;
  --muted-foreground: 215.4 16.3% 46.9%;
  --accent: 210 40% 96.1%;
  --accent-foreground: 222.2 47.4% 11.2%;
  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;
  --border: 214.3 31.8% 91.4%;
  --ring: 222.2 84% 4.9%;
  --radius: 0.5rem;
}

body {
  font-family: system-ui, -apple-system, sans-serif;
  background-color: hsl(var(--background));
  color: hsl(var(--foreground));
}
```

2. Create `apps/admin/src/main.tsx` - entry point with providers:
```typescript
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { ClerkProvider } from '@clerk/clerk-react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import App from './App';
import './index.css';

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY;

if (!PUBLISHABLE_KEY) {
  throw new Error('Missing VITE_CLERK_PUBLISHABLE_KEY environment variable');
}

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5000,
      refetchOnWindowFocus: false,
    },
  },
});

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <QueryClientProvider client={queryClient}>
        <App />
      </QueryClientProvider>
    </ClerkProvider>
  </StrictMode>
);
```

3. Create `apps/admin/src/App.tsx` - main app with auth guard and layout:
```typescript
import { SignedIn, SignedOut, SignIn, UserButton } from '@clerk/clerk-react';

function App() {
  return (
    <>
      <SignedOut>
        <div className="flex min-h-screen items-center justify-center bg-gray-100">
          <SignIn routing="hash" />
        </div>
      </SignedOut>
      <SignedIn>
        <div className="min-h-screen bg-gray-100">
          <header className="bg-white shadow">
            <div className="mx-auto flex max-w-7xl items-center justify-between px-4 py-4">
              <h1 className="text-xl font-bold text-gray-900">Livermore Admin</h1>
              <nav className="flex items-center gap-6">
                <a href="#/" className="text-gray-600 hover:text-gray-900">
                  Portfolio
                </a>
                <a href="#/signals" className="text-gray-600 hover:text-gray-900">
                  Signals
                </a>
                <a href="#/logs" className="text-gray-600 hover:text-gray-900">
                  Logs
                </a>
                <UserButton
                  afterSignOutUrl="/"
                  appearance={{
                    elements: {
                      avatarBox: 'h-8 w-8',
                    },
                  }}
                />
              </nav>
            </div>
          </header>
          <main className="mx-auto max-w-7xl px-4 py-8">
            <HashRouter />
          </main>
        </div>
      </SignedIn>
    </>
  );
}

/**
 * Simple hash-based router for SPA.
 * No external router library needed for 3 pages.
 */
function HashRouter() {
  // Use window.location.hash for routing
  const hash = typeof window !== 'undefined' ? window.location.hash : '#/';

  // Placeholder pages - will be replaced in 15-02
  switch (hash) {
    case '#/signals':
      return (
        <div className="rounded-lg bg-white p-6 shadow">
          <h2 className="text-lg font-semibold">Trade Signals</h2>
          <p className="mt-2 text-gray-600">Coming soon...</p>
        </div>
      );
    case '#/logs':
      return (
        <div className="rounded-lg bg-white p-6 shadow">
          <h2 className="text-lg font-semibold">Logs</h2>
          <p className="mt-2 text-gray-600">Coming soon...</p>
        </div>
      );
    default:
      return (
        <div className="rounded-lg bg-white p-6 shadow">
          <h2 className="text-lg font-semibold">Portfolio Analysis</h2>
          <p className="mt-2 text-gray-600">Coming soon...</p>
        </div>
      );
  }
}

export default App;
```

IMPORTANT: The user must create `.env` file with their Clerk publishable key before running dev server.
  </action>
  <verify>
    1. Create `apps/admin/.env` with valid VITE_CLERK_PUBLISHABLE_KEY
    2. Run `pnpm --filter @livermore/admin dev`
    3. Open http://localhost:5173
    4. Verify sign-in component appears
    5. Sign in with Google OAuth
    6. Verify UserButton shows in header after sign-in
  </verify>
  <done>
    - Sign-in page displays for unauthenticated users
    - After Google OAuth sign-in, user sees header with their avatar in UserButton
    - Navigation links work (Portfolio, Signals, Logs)
    - Placeholder content shows for each route
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @livermore/admin type-check` passes
2. `pnpm --filter @livermore/admin dev` starts without errors
3. Unauthenticated access shows Clerk SignIn component
4. Google OAuth sign-in flow works
5. Authenticated user sees header with UserButton
6. Navigation between Portfolio/Signals/Logs works
</verification>

<success_criteria>
- UI-04 (Clerk sign-in) foundation complete
- User can sign in with Google OAuth
- User sees their identity in header after sign-in
- tRPC client ready for data fetching (with auth headers)
- Foundation ready for 15-02 (Portfolio/Signals) and 15-03 (Logs)
</success_criteria>

<output>
After completion, create `.planning/phases/15-admin-ui/15-01-SUMMARY.md`
</output>
