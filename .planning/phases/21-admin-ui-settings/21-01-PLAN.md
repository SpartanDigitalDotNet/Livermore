---
phase: 21-admin-ui-settings
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/admin/package.json
  - apps/admin/src/App.tsx
  - apps/admin/src/pages/Settings.tsx
  - apps/admin/src/components/ui/sonner.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to Settings page via nav link"
    - "Settings page shows loading spinner while fetching"
    - "Settings page shows error message if fetch fails"
    - "Toast notifications appear for user feedback"
  artifacts:
    - path: "apps/admin/src/pages/Settings.tsx"
      provides: "Settings page with loading/error states"
      min_lines: 40
    - path: "apps/admin/src/components/ui/sonner.tsx"
      provides: "Toaster component for notifications"
      min_lines: 5
  key_links:
    - from: "apps/admin/src/App.tsx"
      to: "apps/admin/src/pages/Settings.tsx"
      via: "hash router case and nav link"
      pattern: "Settings"
    - from: "apps/admin/src/pages/Settings.tsx"
      to: "trpc.settings.get"
      via: "useQuery hook"
      pattern: "trpc\\.settings\\.get"
---

<objective>
Install required libraries and create Settings page shell with loading states and toast notifications.

Purpose: Establish the foundation for the Settings UI - library dependencies, page routing, and loading/error UX patterns that match existing pages.

Output: Settings page accessible via nav, displaying loading spinner during fetch, error state on failure, and Sonner toasts configured for success/error feedback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-admin-ui-settings/21-RESEARCH.md

@apps/admin/src/App.tsx
@apps/admin/src/pages/Dashboard.tsx
@apps/admin/src/lib/trpc.ts
@packages/schemas/src/settings/user-settings.schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and add shadcn sonner component</name>
  <files>apps/admin/package.json, apps/admin/src/components/ui/sonner.tsx</files>
  <action>
    From apps/admin directory, install the required packages:
    ```bash
    pnpm add react-hook-form @hookform/resolvers @monaco-editor/react sonner
    ```

    Then add the shadcn sonner component:
    ```bash
    pnpm dlx shadcn@latest add sonner --yes
    ```

    If shadcn prompts fail, manually create apps/admin/src/components/ui/sonner.tsx:
    ```typescript
    import { Toaster as Sonner } from 'sonner';

    type ToasterProps = React.ComponentProps<typeof Sonner>;

    const Toaster = ({ ...props }: ToasterProps) => {
      return (
        <Sonner
          className="toaster group"
          toastOptions={{
            classNames: {
              toast:
                'group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-950 group-[.toaster]:border-gray-200 group-[.toaster]:shadow-lg',
              description: 'group-[.toast]:text-gray-500',
              actionButton:
                'group-[.toast]:bg-gray-900 group-[.toast]:text-gray-50',
              cancelButton:
                'group-[.toast]:bg-gray-100 group-[.toast]:text-gray-500',
            },
          }}
          {...props}
        />
      );
    };

    export { Toaster };
    ```
  </action>
  <verify>
    - package.json includes react-hook-form, @hookform/resolvers, @monaco-editor/react, sonner
    - apps/admin/src/components/ui/sonner.tsx exists and exports Toaster
  </verify>
  <done>All four packages in dependencies, sonner.tsx component created</done>
</task>

<task type="auto">
  <name>Task 2: Create Settings page with loading and error states</name>
  <files>apps/admin/src/pages/Settings.tsx</files>
  <action>
    Create apps/admin/src/pages/Settings.tsx following the Dashboard.tsx pattern:

    ```typescript
    import { useQuery } from '@tanstack/react-query';
    import { trpc } from '@/lib/trpc';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
    import type { UserSettings } from '@livermore/schemas';

    export function Settings() {
      const { data, isLoading, error, refetch, isFetching } = useQuery(
        trpc.settings.get.queryOptions()
      );

      if (isLoading) {
        return (
          <Card>
            <CardHeader>
              <CardTitle>Settings</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="flex items-center justify-center py-8">
                <div className="h-8 w-8 animate-spin rounded-full border-4 border-gray-200 border-t-gray-600" />
              </div>
            </CardContent>
          </Card>
        );
      }

      if (error) {
        return (
          <Card>
            <CardHeader>
              <CardTitle>Settings</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="rounded-md bg-red-50 p-4 text-red-700">
                Error loading settings: {error.message}
              </div>
            </CardContent>
          </Card>
        );
      }

      const settings = data as UserSettings;

      return (
        <Card>
          <CardHeader className="flex flex-row items-center justify-between">
            <CardTitle>Settings</CardTitle>
            <button
              onClick={() => refetch()}
              disabled={isFetching}
              className="rounded-md bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-200 disabled:opacity-50"
            >
              {isFetching ? 'Refreshing...' : 'Refresh'}
            </button>
          </CardHeader>
          <CardContent>
            <pre className="rounded-md bg-gray-100 p-4 text-sm overflow-auto">
              {JSON.stringify(settings, null, 2)}
            </pre>
          </CardContent>
        </Card>
      );
    }
    ```

    This is a placeholder that will be replaced with the full split-view editor in later plans.
  </action>
  <verify>
    - apps/admin/src/pages/Settings.tsx exists
    - Exports Settings function component
    - Uses trpc.settings.get.queryOptions()
    - Has loading spinner, error state, and data display
  </verify>
  <done>Settings page shows loading state while fetching, error state on failure, and raw JSON when loaded</done>
</task>

<task type="auto">
  <name>Task 3: Add Settings to navigation and integrate Toaster</name>
  <files>apps/admin/src/App.tsx</files>
  <action>
    Update apps/admin/src/App.tsx:

    1. Import Toaster from sonner and Settings page:
       ```typescript
       import { Settings } from './pages/Settings';
       import { Toaster } from '@/components/ui/sonner';
       ```

    2. Add Settings nav link after Logs link (around line 46):
       ```tsx
       <a
         href="#/settings"
         className={`${hash === '#/settings' ? 'text-gray-900 font-medium' : 'text-gray-600'} hover:text-gray-900`}
       >
         Settings
       </a>
       ```

    3. Add Toaster component inside the SignedIn block, after the closing div (around line 65):
       ```tsx
       <Toaster />
       ```

    4. Add case to HashRouter switch:
       ```typescript
       case '#/settings':
         return <Settings />;
       ```
  </action>
  <verify>
    - Run `pnpm --filter admin dev` and navigate to Settings page via nav link
    - Settings page loads and shows loading spinner briefly, then displays settings JSON
    - Test toast by temporarily adding `toast.success('Test')` in Settings useEffect (remove after testing)
  </verify>
  <done>Settings accessible via nav link, Toaster renders, page displays user settings from API</done>
</task>

</tasks>

<verification>
1. `pnpm --filter admin dev` starts without errors
2. Navigate to http://localhost:5173/#/settings
3. See loading spinner, then settings JSON displayed
4. Error state appears if API is down (stop API, refresh page)
5. Toaster component renders (no visible UI until toast is triggered)
</verification>

<success_criteria>
- UI-SET-06 partially satisfied: Loading states implemented, toast infrastructure ready
- Settings page accessible via nav with loading/error/success states
- Foundation ready for form and JSON editor components
</success_criteria>

<output>
After completion, create `.planning/phases/21-admin-ui-settings/21-01-SUMMARY.md`
</output>
