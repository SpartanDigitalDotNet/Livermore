---
phase: 21-admin-ui-settings
plan: 03
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - apps/admin/src/components/ui/input.tsx
  - apps/admin/src/components/ui/label.tsx
  - apps/admin/src/components/ui/switch.tsx
  - apps/admin/src/components/settings/ProfileSection.tsx
  - apps/admin/src/components/settings/RuntimeSection.tsx
  - apps/admin/src/components/settings/SettingsForm.tsx
  - apps/admin/src/components/settings/index.ts
autonomous: true

must_haves:
  truths:
    - "User can edit profile settings via form fields"
    - "User can toggle auto_start via switch control"
    - "User can see current values populated in form fields"
    - "Form validation errors appear on invalid input"
  artifacts:
    - path: "apps/admin/src/components/settings/SettingsForm.tsx"
      provides: "Complete form component for UserSettings"
      min_lines: 50
    - path: "apps/admin/src/components/settings/ProfileSection.tsx"
      provides: "Form section for perseus_profile fields"
      min_lines: 40
    - path: "apps/admin/src/components/settings/RuntimeSection.tsx"
      provides: "Form section for livermore_runtime fields"
      min_lines: 30
  key_links:
    - from: "apps/admin/src/components/settings/SettingsForm.tsx"
      to: "react-hook-form"
      via: "useForm hook"
      pattern: "useForm.*UserSettings"
    - from: "apps/admin/src/components/settings/SettingsForm.tsx"
      to: "@livermore/schemas"
      via: "zodResolver import"
      pattern: "zodResolver.*UserSettingsSchema"
---

<objective>
Create form-based settings editor with section components for common settings.

Purpose: Enable non-technical users to edit settings via intuitive form fields without needing to understand JSON structure. Form sections map to UserSettings schema structure.

Output: SettingsForm component with ProfileSection and RuntimeSection that render form fields for perseus_profile and livermore_runtime settings.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-admin-ui-settings/21-RESEARCH.md
@.planning/phases/21-admin-ui-settings/21-01-SUMMARY.md

@packages/schemas/src/settings/user-settings.schema.ts
@apps/admin/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn form components (input, label, switch)</name>
  <files>apps/admin/src/components/ui/input.tsx, apps/admin/src/components/ui/label.tsx, apps/admin/src/components/ui/switch.tsx</files>
  <action>
    From apps/admin directory, add required shadcn components:
    ```bash
    pnpm dlx shadcn@latest add input label switch --yes
    ```

    If shadcn CLI fails, create the components manually.

    Create apps/admin/src/components/ui/input.tsx:
    ```typescript
    import * as React from 'react';
    import { cn } from '@/lib/utils';

    export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {}

    const Input = React.forwardRef<HTMLInputElement, InputProps>(
      ({ className, type, ...props }, ref) => {
        return (
          <input
            type={type}
            className={cn(
              'flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
              className
            )}
            ref={ref}
            {...props}
          />
        );
      }
    );
    Input.displayName = 'Input';

    export { Input };
    ```

    Create apps/admin/src/components/ui/label.tsx:
    ```typescript
    import * as React from 'react';
    import * as LabelPrimitive from '@radix-ui/react-label';
    import { cn } from '@/lib/utils';

    const Label = React.forwardRef<
      React.ElementRef<typeof LabelPrimitive.Root>,
      React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
    >(({ className, ...props }, ref) => (
      <LabelPrimitive.Root
        ref={ref}
        className={cn(
          'text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70',
          className
        )}
        {...props}
      />
    ));
    Label.displayName = LabelPrimitive.Root.displayName;

    export { Label };
    ```

    Create apps/admin/src/components/ui/switch.tsx:
    ```typescript
    import * as React from 'react';
    import * as SwitchPrimitives from '@radix-ui/react-switch';
    import { cn } from '@/lib/utils';

    const Switch = React.forwardRef<
      React.ElementRef<typeof SwitchPrimitives.Root>,
      React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
    >(({ className, ...props }, ref) => (
      <SwitchPrimitives.Root
        className={cn(
          'peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200',
          className
        )}
        {...props}
        ref={ref}
      >
        <SwitchPrimitives.Thumb
          className={cn(
            'pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0'
          )}
        />
      </SwitchPrimitives.Root>
    ));
    Switch.displayName = SwitchPrimitives.Root.displayName;

    export { Switch };
    ```

    If @radix-ui/react-label and @radix-ui/react-switch are not installed:
    ```bash
    pnpm add @radix-ui/react-label @radix-ui/react-switch
    ```

    Ensure apps/admin/src/lib/utils.ts exists with cn helper (it should from existing shadcn setup).
  </action>
  <verify>
    - apps/admin/src/components/ui/input.tsx exports Input
    - apps/admin/src/components/ui/label.tsx exports Label
    - apps/admin/src/components/ui/switch.tsx exports Switch
    - TypeScript compilation passes
  </verify>
  <done>shadcn form components available for use in settings form</done>
</task>

<task type="auto">
  <name>Task 2: Create ProfileSection and RuntimeSection form components</name>
  <files>apps/admin/src/components/settings/ProfileSection.tsx, apps/admin/src/components/settings/RuntimeSection.tsx</files>
  <action>
    Create apps/admin/src/components/settings/ProfileSection.tsx:
    ```typescript
    import { Controller, UseFormReturn } from 'react-hook-form';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
    import { Input } from '@/components/ui/input';
    import { Label } from '@/components/ui/label';
    import type { UserSettings } from '@livermore/schemas';

    interface ProfileSectionProps {
      form: UseFormReturn<UserSettings>;
    }

    /**
     * Form section for perseus_profile settings.
     * Displays fields for display name, primary exchange, trading mode, timezone, etc.
     */
    export function ProfileSection({ form }: ProfileSectionProps) {
      const { control, formState: { errors } } = form;

      return (
        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Profile</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Controller
              name="perseus_profile.public_name"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="public_name">Display Name</Label>
                  <Input
                    id="public_name"
                    placeholder="My Trading Profile"
                    {...field}
                    value={field.value ?? ''}
                  />
                  {errors.perseus_profile?.public_name && (
                    <p className="text-sm text-red-600">
                      {errors.perseus_profile.public_name.message}
                    </p>
                  )}
                </div>
              )}
            />

            <Controller
              name="perseus_profile.primary_exchange"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="primary_exchange">Primary Exchange</Label>
                  <Input
                    id="primary_exchange"
                    placeholder="coinbase"
                    {...field}
                    value={field.value ?? ''}
                  />
                  {errors.perseus_profile?.primary_exchange && (
                    <p className="text-sm text-red-600">
                      {errors.perseus_profile.primary_exchange.message}
                    </p>
                  )}
                </div>
              )}
            />

            <Controller
              name="perseus_profile.trading_mode"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="trading_mode">Trading Mode</Label>
                  <select
                    id="trading_mode"
                    className="flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950"
                    {...field}
                    value={field.value ?? 'paper'}
                  >
                    <option value="paper">Paper (Simulated)</option>
                    <option value="live">Live (Real Money)</option>
                  </select>
                  {errors.perseus_profile?.trading_mode && (
                    <p className="text-sm text-red-600">
                      {errors.perseus_profile.trading_mode.message}
                    </p>
                  )}
                </div>
              )}
            />

            <Controller
              name="perseus_profile.timezone"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="timezone">Timezone</Label>
                  <Input
                    id="timezone"
                    placeholder="America/New_York"
                    {...field}
                    value={field.value ?? 'UTC'}
                  />
                  {errors.perseus_profile?.timezone && (
                    <p className="text-sm text-red-600">
                      {errors.perseus_profile.timezone.message}
                    </p>
                  )}
                </div>
              )}
            />

            <Controller
              name="perseus_profile.currency"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="currency">Base Currency</Label>
                  <Input
                    id="currency"
                    placeholder="USD"
                    {...field}
                    value={field.value ?? 'USD'}
                  />
                </div>
              )}
            />
          </CardContent>
        </Card>
      );
    }
    ```

    Create apps/admin/src/components/settings/RuntimeSection.tsx:
    ```typescript
    import { Controller, UseFormReturn } from 'react-hook-form';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
    import { Input } from '@/components/ui/input';
    import { Label } from '@/components/ui/label';
    import { Switch } from '@/components/ui/switch';
    import type { UserSettings } from '@livermore/schemas';

    interface RuntimeSectionProps {
      form: UseFormReturn<UserSettings>;
    }

    /**
     * Form section for livermore_runtime settings.
     * Displays auto_start toggle and logging configuration.
     */
    export function RuntimeSection({ form }: RuntimeSectionProps) {
      const { control, formState: { errors } } = form;

      return (
        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Runtime Configuration</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Controller
              name="livermore_runtime.auto_start"
              control={control}
              render={({ field }) => (
                <div className="flex items-center justify-between">
                  <div className="space-y-0.5">
                    <Label htmlFor="auto_start">Auto Start</Label>
                    <p className="text-sm text-gray-500">
                      Automatically start data collection on service startup
                    </p>
                  </div>
                  <Switch
                    id="auto_start"
                    checked={field.value ?? false}
                    onCheckedChange={field.onChange}
                  />
                </div>
              )}
            />

            <Controller
              name="livermore_runtime.logging.verbosity_level"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="verbosity_level">Log Level</Label>
                  <select
                    id="verbosity_level"
                    className="flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950"
                    {...field}
                    value={field.value ?? 'error'}
                  >
                    <option value="error">Error</option>
                    <option value="warn">Warning</option>
                    <option value="info">Info</option>
                    <option value="debug">Debug</option>
                  </select>
                </div>
              )}
            />

            <Controller
              name="livermore_runtime.logging.data_directory"
              control={control}
              render={({ field }) => (
                <div className="space-y-2">
                  <Label htmlFor="data_directory">Data Directory</Label>
                  <Input
                    id="data_directory"
                    placeholder="/var/data/livermore"
                    {...field}
                    value={field.value ?? ''}
                  />
                </div>
              )}
            />
          </CardContent>
        </Card>
      );
    }
    ```
  </action>
  <verify>
    - apps/admin/src/components/settings/ProfileSection.tsx exists and exports ProfileSection
    - apps/admin/src/components/settings/RuntimeSection.tsx exists and exports RuntimeSection
    - Both use Controller from react-hook-form
    - TypeScript types match UserSettings schema paths
  </verify>
  <done>Form sections for profile and runtime settings created with proper field controls</done>
</task>

<task type="auto">
  <name>Task 3: Create SettingsForm wrapper component and update index</name>
  <files>apps/admin/src/components/settings/SettingsForm.tsx, apps/admin/src/components/settings/index.ts</files>
  <action>
    Create apps/admin/src/components/settings/SettingsForm.tsx:
    ```typescript
    import { useForm, UseFormReturn } from 'react-hook-form';
    import { zodResolver } from '@hookform/resolvers/zod';
    import { UserSettingsSchema, type UserSettings } from '@livermore/schemas';
    import { ProfileSection } from './ProfileSection';
    import { RuntimeSection } from './RuntimeSection';

    interface SettingsFormProps {
      /** Initial settings values */
      defaultValues: UserSettings;
      /** Callback when form values change (for sync with JSON editor) */
      onValuesChange?: (values: UserSettings) => void;
      /** External form instance (optional, for controlled mode) */
      form?: UseFormReturn<UserSettings>;
    }

    /**
     * Complete settings form with all section components.
     * Can be used standalone or controlled externally via form prop.
     * Satisfies UI-SET-01.
     */
    export function SettingsForm({
      defaultValues,
      onValuesChange,
      form: externalForm,
    }: SettingsFormProps) {
      // Use external form if provided, otherwise create internal form
      const internalForm = useForm<UserSettings>({
        resolver: zodResolver(UserSettingsSchema),
        defaultValues,
        mode: 'onBlur',
      });

      const form = externalForm ?? internalForm;

      // Subscribe to form changes if callback provided
      if (onValuesChange) {
        form.watch((values) => {
          // Only fire if we have valid values
          if (values) {
            onValuesChange(values as UserSettings);
          }
        });
      }

      return (
        <div className="space-y-6">
          <ProfileSection form={form} />
          <RuntimeSection form={form} />
        </div>
      );
    }

    /**
     * Hook to create a shared form instance for external control.
     * Use this when you need to control the form from a parent component.
     */
    export function useSettingsForm(defaultValues: UserSettings) {
      return useForm<UserSettings>({
        resolver: zodResolver(UserSettingsSchema),
        defaultValues,
        mode: 'onBlur',
      });
    }
    ```

    Update apps/admin/src/components/settings/index.ts:
    ```typescript
    export { SettingsJsonEditor } from './SettingsJsonEditor';
    export { SettingsDiffView } from './SettingsDiffView';
    export { SettingsForm, useSettingsForm } from './SettingsForm';
    export { ProfileSection } from './ProfileSection';
    export { RuntimeSection } from './RuntimeSection';
    ```
  </action>
  <verify>
    - apps/admin/src/components/settings/SettingsForm.tsx exists
    - Exports SettingsForm component and useSettingsForm hook
    - Uses zodResolver with UserSettingsSchema
    - Renders ProfileSection and RuntimeSection
    - Index file exports all settings components
  </verify>
  <done>Complete form component that renders all sections, ready for integration into split view</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `pnpm --filter admin build`
2. All form components exist in apps/admin/src/components/settings/
3. Import paths resolve correctly (test in IDE or via build)
4. Form renders without errors when given valid UserSettings defaultValues
</verification>

<success_criteria>
- UI-SET-01 satisfied: Form-based editor for common settings created
- Form sections map to UserSettings schema structure
- Zod validation integrated via react-hook-form resolver
- Components ready for integration with JSON editor in split view
</success_criteria>

<output>
After completion, create `.planning/phases/21-admin-ui-settings/21-03-SUMMARY.md`
</output>
