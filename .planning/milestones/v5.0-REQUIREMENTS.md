# Requirements Archive: v5.0 Distributed Exchange Architecture

**Archived:** 2026-02-08
**Status:** SHIPPED

This is the archived requirements specification for v5.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v5.0 Requirements

### Exchange Management

- [x] **EXC-01**: `exchanges` metadata table with API limits, fees, geo restrictions, supported timeframes, WebSocket URLs
- [x] **EXC-02**: `user_exchanges` FK refactor to reference `exchanges` table (normalize exchange data)
- [x] **EXC-03**: Exchange adapter factory that instantiates correct adapter (Coinbase/Binance) based on exchange type
- [x] **EXC-04**: Exchange connection status tracking (`connected_at`, `last_heartbeat`, `connection_state`)

### Data Architecture

- [x] **DATA-01**: Exchange-scoped candle keys `candles:{exchange_id}:{symbol}:{timeframe}` (shared pool for Tier 1)
- [x] **DATA-02**: Exchange-scoped indicator keys `indicator:{exchange_id}:{symbol}:{timeframe}:{type}` (shared calculations)
- [x] **DATA-03**: User overflow keys `usercandles:{userId}:{exchange_id}:{symbol}:{timeframe}` with TTL for positions
- [x] **DATA-04**: Dual-read pattern (indicator service checks exchange-scoped first, falls back to user-scoped)
- [x] **DATA-05**: Cross-exchange pub/sub channels `channel:exchange:{exchange_id}:candle:close:{symbol}:{timeframe}`

### Symbol Management

- [x] **SYM-01**: Tier 1 symbol list - Top N by 24h volume (exchange-driven, shared pool)
- [x] **SYM-02**: Tier 2 user positions - Auto-subscribe held positions (de-duped against Tier 1)
- [x] **SYM-04**: Symbol de-duplication logic (Tier 2 entries matching Tier 1 use shared pool)

### Startup/Control

- [x] **CTL-01**: Idle startup mode - API starts without WebSocket connections, awaits `start` command
- [x] **CTL-02**: `start` command to initiate exchange connections (replaces auto-connect)
- [x] **CTL-03**: `--autostart <exchange>` CLI flag to bypass idle mode for specific exchange
- [x] **CTL-04**: Connection lifecycle events (`exchange:connecting`, `exchange:connected`, `exchange:disconnected`)

### Cross-Exchange Visibility

- [x] **VIS-01**: Exchange-scoped alert channels `channel:alerts:{exchange_id}` (not user-scoped)
- [x] **VIS-02**: Cross-exchange subscription - Client can subscribe to any exchange's feed
- [x] **VIS-03**: Alert source attribution - Alert payloads include `source_exchange_id` field

## v5.1+ Requirements (Deferred)

### Autostart Authentication

- **AUTH-01**: Autostart user context - `--autostart <exchange> --user <clerk_id>` or `LIVERMORE_SYSTEM_USER` env var
- **AUTH-02**: System user concept - Unattended operation without interactive Clerk login
- **AUTH-03**: User settings loading on autostart - Load user's symbols/settings from database by user ID

### Symbol Management

- **SYM-03**: Tier 2 manual adds - User-added symbols with validation + de-dupe
- **SYM-05**: Symbol metrics endpoint - 24h volume, price, market cap for add/remove decisions

## Out of Scope

| Feature | Reason |
|---------|--------|
| Trade execution | Monitoring-only platform; execution adds complexity, liability, regulatory burden |
| Order book aggregation | Full Level2 orderbook across exchanges not needed for MACD-V signals |
| Cross-exchange position netting | Complex reconciliation, unclear value for signal platform |
| Automatic exchange failover | Switching exchanges mid-session could confuse signal context |
| Azure Service Bus | Redis pub/sub sufficient for current scale |
| Real-time arbitrage execution | Requires sub-second execution; soft-arbitrage (signals only) is safer |
| CCXT integration | Abstraction overhead; native adapters are faster and more controllable |
| 1m candle support | Coinbase WebSocket only provides native 5m; 1m requires ticker aggregation |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| EXC-01 | 23 | Complete |
| EXC-02 | 23 | Complete |
| EXC-03 | 28 | Complete |
| EXC-04 | 28 | Complete |
| DATA-01 | 24 | Complete |
| DATA-02 | 24 | Complete |
| DATA-03 | 24 | Complete |
| DATA-04 | 24 | Complete |
| DATA-05 | 24 | Complete |
| SYM-01 | 25 | Complete |
| SYM-02 | 25 | Complete |
| SYM-04 | 25 | Complete |
| CTL-01 | 26 | Complete |
| CTL-02 | 26 | Complete |
| CTL-03 | 26 | Complete |
| CTL-04 | 26 | Complete |
| VIS-01 | 27 | Complete |
| VIS-02 | 27 | Complete |
| VIS-03 | 27 | Complete |

## Milestone Summary

**Shipped:** 19 of 19 v1 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-02-08 as part of v5.0 milestone completion*
